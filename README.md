# Прогнозирование биологической активности химических соединений

## 1. О проекте
Данный проект представляет собой end-to-end решение задачи по прогнозированию эффективности и токсичности химических соединений против вируса гриппа. На основе 214 молекулярных дескрипторов для ~900 соединений (после очистки) были построены и валидированы 7 моделей машинного обучения.

Проект демонстрирует полный цикл работы Data Scientist'а: от глубокого анализа данных и инжиниринга признаков до построения сложных ансамблевых моделей, их валидации и создания системы для автоматической проверки и генерации отчетов.

## 2. Ключевые этапы работы
Пайплайн был разделен на несколько логических этапов для обеспечения высокого качества и воспроизводимости.

**2.1. Глубокий исследовательский анализ (EDA)**
- **Нормализация целевых переменных:** Ключевые показатели (IC50, CC50, SI) были логарифмированы (`log1p`) для стабилизации дисперсии и приведения распределения к нормальному.
- **Очистка данных:** Проведено удаление выбросов методом межквартильного размаха (IQR), а также удаление константных и низковариативных признаков.
- **Инжиниринг признаков:** Созданы новые синтетические признаки (например, `EState_Delta`, `MolWt_x_TPSA`) для захвата более сложных зависимостей в данных.
- **Анализ мультиколлинеарности:** Удалены сильно скоррелированные (r > 0.95) признаки с сохранением наиболее важных по метрике Mutual Information.

**2.2. Многоступенчатый отбор признаков**
Чтобы использовать только самую релевантную информацию, был применен каскадный отбор признаков:
1.  **Первичный отбор (Mutual Information):** Для каждой из 7 задач был сформирован свой уникальный, оптимальный набор признаков.
2.  **Финальный отбор (SHAP):** После обучения моделей с помощью SHAP были определены признаки, вносящие наибольший вклад в итоговое предсказание.

**2.3. Комплексное моделирование и валидация**
- **Сравнение алгоритмов:** Для каждой задачи тестировались и настраивались (с помощью `GridSearchCV`) мощные модели градиентного бустинга (`CatBoost`, `XGBoost`).
- **Ансамблирование:** Для повышения качества использовался стекинг (`StackingClassifier`/`Regressor`), объединяющий предсказания базовых моделей.
- **Синхронизация артефактов:** **Ключевой шаг пайплайна** — финальная модель для каждой задачи была заново обучена *только* на том наборе признаков, который был выбран как оптимальный после SHAP-анализа. Это гарантирует, что сохраненные модель и список признаков идеально соответствуют друг другу.
- **Автоматическая проверка (`sanity_check.py`):** Создан специальный скрипт, который автоматически проверяет работоспособность и совместимость всех сохраненных артефактов для всех 7 задач.

## 3. Структура репозитория

CML_Final/
├── data/
│   └── eda_gen/                # Данные, сгенерированные в ходе EDA
│       └── data_final.csv      # Финальный датасет для обучения
├── features/                   # Списки признаков, отобранные SHAP
├── models/                     # Сохраненные модели и артефакты (.joblib)
├── plots/                      # Все сгенерированные графики и дашборды
├── main.py                     # Главный скрипт, запускающий весь пайплайн
├── eda_general.py              # Скрипт разведочного анализа и подготовки данных
├── clf_ic50_median.py          # Скрипт классификации IC50 > median
├── clf_cc50_median.py          # Скрипт классификации CC50 > median
├── clf_si_median.py            # Скрипт классификации SI > median
├── clf_si_gt8.py               # Скрипт классификации SI > 8
├── reg_ic50.py                 # Скрипт регрессии IC50
├── reg_cc50.py                 # Скрипт регрессии CC50
├── reg_si.py                   # Скрипт регрессии SI
├── sanity_check.py             # Скрипт проверки артефактов моделей
├── report_generator.py         # Скрипт генерации итогового отчета
├── utils.py                    # Вспомогательные функции и константы
├── requirements.txt            # Файл с зависимостями
└── README.md                   # Этот файл


## 4. Результаты
Финальные метрики качества, полученные в ходе автоматической проверки (`sanity_check.py`) на всём наборе данных.

### **Классификация**
| Задача | ROC AUC | F1-Score | Accuracy |
|:---|:---:|:---:|:---:|
| IC50 > Median | 0.926 | 0.848 | 0.847 |
| CC50 > Median | 0.969 | 0.900 | 0.900 |
| SI > Median | 0.948 | 0.881 | 0.884 |
| SI > 8 | 0.929 | 0.793 | 0.859 |

### **Регрессия**
| Задача | R² | RMSE | MAE |
|:---|:---:|:---:|:---:|
| Предсказание log(IC50) | 0.658 | 1.041 | 0.823 |
| Предсказание log(CC50) | 0.781 | 0.656 | 0.435 |
| Предсказание log(SI) | 0.654 | 0.630 | 0.457 |


## 5. Как воспроизвести пайплайн
1.  Клонируйте репозиторий.
2.  Установите все зависимости:
    ```bash
    pip install -r requirements.txt
    ```
3.  Для полного выполнения проекта от начала до конца (EDA, обучение 7 моделей, проверка, генерация графиков и отчетов) запустите главный скрипт:
    ```bash
    python main.py
    ```
4.  Для запуска отдельных этапов (после того, как `main.py` отработал хотя бы раз):
    ```bash
    # Только финальная проверка готовых моделей
    python sanity_check.py

    # Только генерация финальных отчетов (текстового и графического)
    python report_generator.py
    ```

## 6. Основные выводы
Проведенное исследование показало, что на основе химических дескрипторов **возможно с высокой точностью прогнозировать ключевые параметры эффективности и токсичности соединений**.

Разработанные модели представляют собой **готовый инструмент поддержки принятия решений**, который позволяет:
- **Значительно ускорить** процесс R&D новых лекарств.
- **Снизить затраты** на дорогостоящие лабораторные исследования.
- **Сфокусировать усилия химиков** на наиболее перспективных соединениях, отсеивая бесперспективные кандидаты на ранней стадии.

Весь процесс полностью автоматизирован и воспроизводим, что обеспечивает надежность и достоверность полученных результатов.
